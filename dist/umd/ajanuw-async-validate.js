!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.AjanuwAsyncValidate=r():t.AjanuwAsyncValidate=r()}(this,(function(){return(()=>{"use strict";var t={d:(r,e)=>{for(var n in e)t.o(e,n)&&!t.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:e[n]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};t.r(r),t.d(r,{AsyncValidate:()=>o});const e="validators";function n(t){return 0===Object.keys(t).length}function i(t){return"[object Object]"===Object.prototype.toString.call(t)}function a(t){if(!t)return[];if(Array.isArray(t))return t;if("function"==typeof t)return[t];if(i(t)){let r=[];for(const n in t)if(![e,"fail"].includes(n)){if(!o.hasOwnProperty(n))throw new Error(`[[ AsyncValidate ]] not "${n}" validate.`);{let e=t[n];Array.isArray(e)||(e=[e]),r.push(o[n](...e))}}return t.validators instanceof o||i(t.validators)||(r=r.concat(a(t.validators))),r}return[]}class o{constructor(t,r){this.validateConfig=t,this.options=Object.assign({checkAll:!1},r)}static firstError(t){if(t&&Object.keys(t).length)return Object.values(t[Object.keys(t)[0]].errors)[0]}static mixin(t){Object.keys(t).filter((t=>{if(!o.hasOwnProperty(t))return t})).forEach((r=>o[r]=t[r]))}async checkValue(t,r,e,n){for(const i of a(t)){const t=await i(r,e);t&&n(t)}}_fail(t){n(t)||(this.options.fail?this.options.fail(t):o.fail&&o.fail(t))}async validate(t,r){const e={};let a=!0;t??(t={});for(const[r,s]of Object.entries(this.validateConfig)){if(!s)continue;if(!(r in t))throw new Error(`AsyncValidate Error: 没有 ${r} 数据!`);const c=t[r];if(await this.checkValue(s,c,t,(n=>{e[r]??(e[r]={value:c,data:t,errors:{}}),Object.assign(e[r].errors,n)})),r in e&&"fail"in s&&s.fail?.(e[r]),a=n(e),!a&&!this.options.checkAll)break;if(s.hasOwnProperty("validators")&&i(s.validators)){const t=new o(s.validators,this.options);if(a=await t.validate(c),!a&&!this.options.checkAll)break}}return a||(this._fail(e),r?.(e)),a}static and(t,r){return async(e,n)=>{for await(const i of t)if(await i(e,n))return{and:r};return null}}static or(t,r){return async(e,n)=>{let i;for await(const r of t)if(i=await r(e,n),!i)return null;return{or:r}}}static required(t){return r=>{if(!r)return{required:t}}}static len(t,r){return e=>{if(!e.hasOwnProperty("length")||e.length!==t)return{len:r}}}static minLength(t,r){return e=>{if(!e.hasOwnProperty("length")||e.length<parseFloat(t))return{minLength:r}}}static maxLength(t,r){return e=>{if(!e.hasOwnProperty("length")||e.length>parseFloat(t))return{maxLength:r}}}static phone(t){return r=>{if("string"==typeof r&&!r.match(o.PHONE_EXP))return{phone:t}}}static eql(t,r){return e=>{if(e!==t)return{eql:r}}}static equal(t,r){return e=>{if(e!=t)return{equal:r}}}static bool(t){return r=>{if(!0!==r&&!1!==r)return{bool:t}}}static email(t){return r=>{if(!r.match(o.EMAIL_EXP))return{email:t}}}static max(t,r){return e=>{if(!isNaN(e)&&e>parseFloat(t))return{max:r}}}static min(t,r){return e=>{if(!isNaN(e)&&e<parseFloat(t))return{min:r}}}static hex(t){return r=>{if(r=(r=r.replace(/^0x/i,"")).replace(/h$/i,""),/[^0-9a-fA-F]/.test(r))return{hex:t}}}static number(t){return r=>{if(!Number.isFinite(r)||"number"!=typeof r)return{number:t}}}static int(t){return(r,e)=>{if(this.number("")(r,e)||!Number.isSafeInteger(r))return{int:t}}}static float(t){return(r,e)=>{if(this.number("")(r,e)||Number.isInteger(r))return{float:t}}}static array(t){return r=>{if(!Array.isArray(r))return{array:t}}}static object(t){return r=>{if("[object Object]"!==Object.prototype.toString.call(r))return{object:t}}}static json(t){return r=>{try{JSON.parse(r)}catch(r){return{json:t}}}}static regexp(t){return r=>{if(!(r instanceof RegExp))return{regexp:t}}}static string(t){return r=>"string"==typeof r?null:{string:t}}}return o.PHONE_EXP=/^((13[0-9])|(14[0-9])|(15[0-9])|(16[0-9])|(17[0-9])|(18[0-9])|(19[0-9]))\d{8}$/,o.EMAIL_EXP=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,r})()}));